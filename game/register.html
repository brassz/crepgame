<!DOCTYPE html>
<html>
    <head>
        <title>DADOS DA SORTE - Criar Conta</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, minimal-ui" />
        <link rel="stylesheet" href="css/reset.css" type="text/css">
        <link rel="stylesheet" href="css/main.css" type="text/css">
        <style>
            * {
                box-sizing: border-box;
            }
            body{
                background:url('sprites/bg_menu.jpg') center/cover no-repeat fixed; 
                min-height:100vh; 
                display:flex; 
                align-items:center; 
                justify-content:center;
                margin: 0;
                padding: 0;
            }
            .auth-container{
                width:100%;
                max-width:420px;
                margin:20px;
                padding:32px 24px;
                background:rgba(6,12,18,0.95);
                border:2px solid rgba(255,255,255,0.1);
                box-shadow:0 10px 30px rgba(0,0,0,0.6);
                border-radius:12px;
                color:#fff;
                position: relative;
            }
            .logo{
                display:block;
                margin:0 auto 12px auto; 
                width:200px; 
                max-width:70%;
            }
            .brand{
                display:block;
                text-align:center;
                font-family:'arialbold', Arial, sans-serif;
                color:#fff;
                font-size:30px;
                letter-spacing:1px;
                text-shadow:0 2px 0 rgba(0,0,0,0.5), 0 4px 10px rgba(0,0,0,0.6);
                margin-bottom: 8px;
            }
            .auth-container h1{
                margin:8px 0 20px;
                font-size:26px; 
                text-align:center; 
                font-family:'arialbold', Arial, sans-serif; 
                letter-spacing:0.5px;
            }
            .auth-container input{
                width:100%;
                padding:12px 14px;
                margin:10px 0;
                background:#0f172a;
                border:1px solid #334155;
                color:#e5e7eb;
                border-radius:8px; 
                font-family:'arialbold', Arial, sans-serif;
                font-size: 14px;
                box-sizing: border-box;
            }
            .auth-container input::placeholder{
                color:#9ca3af;
            }
            .auth-container button{
                width:100%;
                padding:14px;
                margin:16px 0 8px 0;
                background:linear-gradient(180deg,#22c55e 0%, #16a34a 100%);
                border:0;
                color:#052e1a;
                border-radius:999px;
                font-weight:bold;
                cursor:pointer; 
                text-transform:uppercase; 
                letter-spacing:0.5px; 
                font-family:'arialbold', Arial, sans-serif; 
                font-size: 15px;
                box-shadow:0 6px 0 #0b5d2b;
                box-sizing: border-box;
            }
            .auth-container button:active{
                transform:translateY(2px); 
                box-shadow:0 4px 0 #0b5d2b;
            }
            .auth-container .muted{
                color:#cbd5e1;
                text-align:center;
                margin-top:12px;
                font-size: 14px;
            }
            .auth-container .muted a{
                color:#22c55e; 
                text-decoration:none;
            }
            .auth-container .muted a:hover{
                text-decoration:underline;
            }
            .auth-container .error{
                color:#f87171;
                margin-top:10px; 
                text-align:center;
                font-size: 14px;
            }
            .auth-container .success{
                color:#22c55e;
                background:rgba(34, 197, 94, 0.1);
                padding:10px;
                border-radius:8px;
                margin-top:10px; 
                text-align:center;
                font-size: 14px;
                border:1px solid rgba(34, 197, 94, 0.3);
            }
            .info-box{
                background:rgba(34, 197, 94, 0.15);
                border:1px solid rgba(34, 197, 94, 0.3);
                border-radius:8px;
                padding:12px;
                margin:12px 0;
                color:#22c55e;
                text-align:center;
                font-size: 14px;
                font-family:'arialbold', Arial, sans-serif;
            }
        </style>
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
        <script type="text/javascript" src="js/auth-config.js"></script>
        <script type="text/javascript" src="js/custom-auth.js"></script>
    </head>
    <body>
        <div class="auth-container">
            <div class="brand">DADOS DA SORTE</div>
            <h1>Criar Conta</h1>
            <form id="register-form">
                <input id="full-name" type="text" placeholder="Nome Completo" required>
                <input id="username" type="text" placeholder="Nome de Jogador (username)" required>
                <input id="email" type="email" placeholder="Email" required autocomplete="email">
                <input id="cpf" type="text" placeholder="CPF (apenas números)" required maxlength="11">
                <input id="password" type="password" placeholder="Senha (mínimo 6 caracteres)" required minlength="6" autocomplete="new-password">
                <input id="confirm-password" type="password" placeholder="Confirmar Senha" required minlength="6" autocomplete="new-password">
                <button type="submit">Criar Conta</button>
            </form>
            
            <div id="error" class="error" style="display:none;"></div>
            <div id="success" class="success" style="display:none;"></div>
            <div class="muted">Já tem conta? <a href="login.html">Entrar</a></div>
        </div>

        <script>
            (function(){
                // Redirecionar se já estiver logado
                function redirectIfLogged(){
                    var user = window.customAuth.getCurrentUser();
                    if(user){
                        window.location.href = "index.html";
                    }
                }
                
                // Aguardar carregamento do custom-auth
                var checkInterval = setInterval(function(){
                    if(window.customAuth){
                        clearInterval(checkInterval);
                        redirectIfLogged();
                    }
                }, 100);

                // Máscara para CPF (apenas números)
                document.getElementById('cpf').addEventListener('input', function(e){
                    e.target.value = e.target.value.replace(/\D/g, '');
                });

                // Validação de CPF
                function validateCPF(cpf) {
                    cpf = cpf.replace(/\D/g, '');
                    if (cpf.length !== 11) return false;
                    if (/^(\d)\1+$/.test(cpf)) return false;
                    
                    let sum = 0;
                    for (let i = 0; i < 9; i++) {
                        sum += parseInt(cpf.charAt(i)) * (10 - i);
                    }
                    let digit = 11 - (sum % 11);
                    if (digit >= 10) digit = 0;
                    if (digit !== parseInt(cpf.charAt(9))) return false;
                    
                    sum = 0;
                    for (let i = 0; i < 10; i++) {
                        sum += parseInt(cpf.charAt(i)) * (11 - i);
                    }
                    digit = 11 - (sum % 11);
                    if (digit >= 10) digit = 0;
                    if (digit !== parseInt(cpf.charAt(10))) return false;
                    
                    return true;
                }

                var form = document.getElementById('register-form');
                form.addEventListener('submit', async function(e){
                    e.preventDefault();
                    
                    var fullName = document.getElementById('full-name').value.trim();
                    var username = document.getElementById('username').value.trim();
                    var email = document.getElementById('email').value.trim();
                    var cpf = document.getElementById('cpf').value.replace(/\D/g, '');
                    var password = document.getElementById('password').value;
                    var confirmPassword = document.getElementById('confirm-password').value;
                    
                    // Validações
                    if(!fullName || fullName.length < 3){
                        showError('Por favor, insira seu nome completo (mínimo 3 caracteres)');
                        return;
                    }
                    
                    if(!username || username.length < 3){
                        showError('O nome de jogador deve ter no mínimo 3 caracteres');
                        return;
                    }
                    
                    // Validar username (apenas letras, números e underscore)
                    if(!/^[a-zA-Z0-9_]+$/.test(username)){
                        showError('O nome de jogador deve conter apenas letras, números e underscore (_)');
                        return;
                    }
                    
                    if(!email || !email.includes('@')){
                        showError('Por favor, insira um email válido');
                        return;
                    }
                    
                    if(cpf.length !== 11){
                        showError('CPF deve ter 11 dígitos');
                        return;
                    }
                    
                    if(!validateCPF(cpf)){
                        showError('CPF inválido');
                        return;
                    }
                    
                    if(password !== confirmPassword){
                        showError('As senhas não coincidem!');
                        return;
                    }
                    
                    if(password.length < 6){
                        showError('A senha deve ter no mínimo 6 caracteres');
                        return;
                    }
                    
                    // Desabilitar botão durante o processo
                    var submitBtn = form.querySelector('button[type="submit"]');
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'Criando conta...';
                    
                    try {
                        // Registrar usuário usando sistema customizado
                        const result = await window.customAuth.register(email, username, password, fullName, cpf);
                        
                        if(!result.success){
                            showError(result.error || 'Erro ao criar conta');
                            submitBtn.disabled = false;
                            submitBtn.textContent = 'Criar Conta';
                        } else {
                            hideError();
                            showSuccess('✅ Conta criada com sucesso! Você será redirecionado para o login...');
                            
                            // Redirecionar após 2 segundos
                            setTimeout(function(){
                                window.location.href = "login.html";
                            }, 2000);
                        }
                    } catch(error) {
                        showError('Erro ao criar conta: ' + error.message);
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Criar Conta';
                    }
                });

                function showError(msg){
                    var el = document.getElementById('error');
                    el.textContent = msg;
                    el.style.display = 'block';
                    
                    var successEl = document.getElementById('success');
                    successEl.style.display = 'none';
                }
                
                function hideError(){
                    var el = document.getElementById('error');
                    el.style.display = 'none';
                }
                
                function showSuccess(msg){
                    var el = document.getElementById('success');
                    el.textContent = msg;
                    el.style.display = 'block';
                    
                    var errorEl = document.getElementById('error');
                    errorEl.style.display = 'none';
                }
            })();
        </script>
    </body>
</html>

