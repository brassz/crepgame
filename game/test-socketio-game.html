<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste do Cliente de Jogo Socket.IO (Puro)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .panel {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #444;
        }
        
        h1, h2 {
            color: #FFD700;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .status.connected {
            background: #2d5016;
            color: #7fff00;
        }
        
        .status.disconnected {
            background: #501616;
            color: #ff4444;
        }
        
        .input-group {
            margin: 15px 0;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #FFD700;
        }
        
        input {
            width: 100%;
            padding: 8px;
            border: 1px solid #444;
            background: #333;
            color: #fff;
            border-radius: 3px;
        }
        
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #FFD700;
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        button:hover {
            background: #FFA500;
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .log {
            background: #000;
            padding: 10px;
            height: 300px;
            overflow-y: auto;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin: 3px 0;
            padding: 3px;
        }
        
        .log-info { color: #7fff00; }
        .log-error { color: #ff4444; }
        .log-game { color: #00bfff; }
        .log-dice { color: #FFD700; }
        
        .game-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        
        .info-box {
            background: #333;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }
        
        .info-label {
            color: #999;
            font-size: 12px;
        }
        
        .info-value {
            color: #FFD700;
            font-size: 24px;
            font-weight: bold;
        }
        
        .dice-result {
            font-size: 48px;
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>ðŸŽ² Teste do Cliente de Jogo Socket.IO (Puro)</h1>
    
    <div class="container">
        <!-- Left Panel: Connection & Controls -->
        <div class="panel">
            <h2>ConexÃ£o e Controles</h2>
            
            <div class="status disconnected" id="status">
                âšª Desconectado
            </div>
            
            <div class="input-group">
                <label>ID do UsuÃ¡rio:</label>
                <input type="text" id="userId" value="player1" />
            </div>
            
            <div class="input-group">
                <label>Nome de usuÃ¡rio:</label>
                <input type="text" id="username" value="Jogador 1" />
            </div>
            
            <div class="input-group">
                <label>ID da Sala:</label>
                <input type="text" id="roomId" value="table1" />
            </div>
            
            <div class="input-group">
                <label>CrÃ©dito Inicial:</label>
                <input type="number" id="credit" value="1000" />
            </div>
            
            <button onclick="connect()">Conectar</button>
            <button onclick="disconnect()">Desconectar</button>
            
            <hr style="margin: 20px 0; border-color: #444;">
            
            <h3>AÃ§Ãµes do Jogo</h3>
            
            <div class="input-group">
                <label>Valor da Aposta:</label>
                <input type="number" id="betAmount" value="10" />
            </div>
            
            <div class="input-group">
                <label>Tipo de Aposta:</label>
                <input type="text" id="betType" value="pass_line" />
            </div>
            
            <button onclick="placeBet()" id="btnBet" disabled>Fazer Aposta</button>
            <button onclick="clearBets()" id="btnClear" disabled>Limpar Apostas</button>
            <button onclick="rollDice()" id="btnRoll" disabled>LanÃ§ar Dados</button>
            <button onclick="getState()" id="btnState" disabled>Obter Estado</button>
        </div>
        
        <!-- Right Panel: Game State -->
        <div class="panel">
            <h2>Estado do Jogo</h2>
            
            <div class="game-info">
                <div class="info-box">
                    <div class="info-label">Seu CrÃ©dito</div>
                    <div class="info-value" id="playerCredit">0</div>
                </div>
                <div class="info-box">
                    <div class="info-label">Ponto</div>
                    <div class="info-value" id="gamePoint">-</div>
                </div>
                <div class="info-box">
                    <div class="info-label">Atirador</div>
                    <div class="info-value" id="currentShooter" style="font-size: 16px;">-</div>
                </div>
                <div class="info-box">
                    <div class="info-label">Jogadores</div>
                    <div class="info-value" id="playerCount">0</div>
                </div>
            </div>
            
            <div class="dice-result" id="diceResult">
                ðŸŽ² ðŸŽ²
            </div>
            
            <div style="text-align: center; color: #FFD700; font-size: 18px;" id="gameMessage">
                Aguardando conexÃ£o...
            </div>
        </div>
    </div>
    
    <!-- Full Width: Event Log -->
    <div class="panel" style="margin-top: 20px;">
        <h2>Registro de Eventos</h2>
        <div class="log" id="log"></div>
        <button onclick="clearLog()">Limpar Registro</button>
    </div>
    
    <!-- Load Socket.IO -->
    <script src="/socket.io/socket.io.js"></script>
    
    <!-- Load Game Client -->
    <script src="js/game-client-socketio.js"></script>
    
    <script>
        let gameClient = window.GameClientSocketIO;
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function updateStatus(connected) {
            const statusDiv = document.getElementById('status');
            if (connected) {
                statusDiv.className = 'status connected';
                statusDiv.textContent = 'ðŸŸ¢ Conectado';
                document.getElementById('btnBet').disabled = false;
                document.getElementById('btnClear').disabled = false;
                document.getElementById('btnRoll').disabled = false;
                document.getElementById('btnState').disabled = false;
            } else {
                statusDiv.className = 'status disconnected';
                statusDiv.textContent = 'ðŸ”´ Desconectado';
                document.getElementById('btnBet').disabled = true;
                document.getElementById('btnClear').disabled = true;
                document.getElementById('btnRoll').disabled = true;
                document.getElementById('btnState').disabled = true;
            }
        }
        
        function connect() {
            const userId = document.getElementById('userId').value;
            const username = document.getElementById('username').value;
            const roomId = document.getElementById('roomId').value;
            const credit = parseInt(document.getElementById('credit').value);
            
            log(`Conectando como ${username}...`, 'info');
            
            gameClient.init()
                .then(() => {
                    log('Socket.IO inicializado', 'info');
                    gameClient.authenticate(userId, username, roomId, credit);
                })
                .catch(error => {
                    log(`Erro de conexÃ£o: ${error.message}`, 'error');
                });
        }
        
        function disconnect() {
            gameClient.disconnect();
            log('Desconectado', 'info');
        }
        
        function placeBet() {
            const betType = document.getElementById('betType').value;
            const amount = parseInt(document.getElementById('betAmount').value);
            
            log(`Fazendo aposta: ${betType} por ${amount}`, 'game');
            gameClient.placeBet(betType, amount);
        }
        
        function clearBets() {
            log('Limpando apostas...', 'game');
            gameClient.clearBets();
        }
        
        function rollDice() {
            log('LanÃ§ando dados...', 'dice');
            gameClient.rollDice();
        }
        
        function getState() {
            log('Solicitando estado do jogo...', 'info');
            gameClient.requestGameState();
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        function updateGameUI(state) {
            document.getElementById('playerCredit').textContent = gameClient.currentCredit;
            document.getElementById('gamePoint').textContent = state.point || '-';
            document.getElementById('playerCount').textContent = state.players ? state.players.length : 0;
            
            if (state.currentShooter) {
                const shooter = state.players?.find(p => p.userId === state.currentShooter);
                document.getElementById('currentShooter').textContent = shooter ? shooter.username : state.currentShooter;
            }
        }
        
        // Setup event handlers
        gameClient.onConnected(() => {
            log('âœ… Conectado ao servidor', 'info');
            updateStatus(true);
        });
        
        gameClient.onDisconnected((reason) => {
            log(`âŒ Desconectado: ${reason}`, 'error');
            updateStatus(false);
        });
        
        gameClient.onAuthenticated(() => {
            log('âœ… Autenticado com sucesso', 'info');
            document.getElementById('gameMessage').textContent = 'Pronto para jogar!';
        });
        
        gameClient.onGameState((state) => {
            log(`ðŸ“Š Estado do jogo recebido`, 'game');
            updateGameUI(state);
        });
        
        gameClient.onDiceRolled((rollData) => {
            log(`ðŸŽ² Dados lanÃ§ados: ${rollData.dice1} + ${rollData.dice2} = ${rollData.total}`, 'dice');
            document.getElementById('diceResult').textContent = `ðŸŽ² ${rollData.dice1}  ðŸŽ² ${rollData.dice2}  = ${rollData.total}`;
            document.getElementById('gameMessage').textContent = `Resultado: ${rollData.total}`;
        });
        
        gameClient.onBetConfirmed((confirmation) => {
            log(`âœ… Aposta confirmada: ${confirmation.betType} por ${confirmation.amount}`, 'game');
            document.getElementById('playerCredit').textContent = confirmation.remainingCredit;
        });
        
        gameClient.onBetsCleared((data) => {
            log(`ðŸ§¹ Apostas limpas. Reembolso: ${data.refundAmount}`, 'game');
            document.getElementById('playerCredit').textContent = data.remainingCredit;
        });
        
        gameClient.onGameResult((result) => {
            log(`ðŸŽ¯ Resultado do jogo: ${result.type} - ${result.message}`, 'dice');
            document.getElementById('gameMessage').textContent = result.message;
        });
        
        gameClient.onPointEstablished((data) => {
            log(`ðŸ“ Ponto estabelecido: ${data.point}`, 'game');
            document.getElementById('gamePoint').textContent = data.point;
            document.getElementById('gameMessage').textContent = data.message;
        });
        
        gameClient.onShooterChanged((data) => {
            log(`ðŸ”„ Atirador mudou para: ${data.shooterName}`, 'game');
            document.getElementById('currentShooter').textContent = data.shooterName;
        });
        
        gameClient.onPlayersUpdated((players) => {
            log(`ðŸ‘¥ Jogadores atualizados: ${players.length} jogador(es)`, 'info');
            document.getElementById('playerCount').textContent = players.length;
        });
        
        gameClient.onError((error) => {
            log(`âŒ Erro: ${error.message}`, 'error');
        });
        
        gameClient.onUserJoined((userData) => {
            log(`ðŸ‘¤ ${userData.username} entrou na sala`, 'info');
        });
        
        gameClient.onUserLeft((userData) => {
            log(`ðŸ‘¤ ${userData.username} saiu da sala`, 'info');
        });
        
        log('PÃ¡gina de teste carregada. Clique em Conectar para iniciar.', 'info');
    </script>
</body>
</html>
